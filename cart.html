<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.3">
  <title>Gi·ªè H√†ng</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
  <link rel="stylesheet" href="css/cart-page.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
  <header class="header">
    <div class="header-container">
      <div class="logo">FASHION STORE</div>
      <nav class="nav">
        <a href="index.html">Trang ch·ªß</a>
        <a href="khuyen_mai.html">Khuy·∫øn m√£i</a>
        <a href="account.html">T√†i kho·∫£n</a>
        <a href="cart.html" class="cart-link">
          <span class="cart-icon">üõí</span>
          <span class="cart-count" style="display:none;">0</span>
        </a>
      </nav>
    </div>
  </header>

  <main class="cart-page">
    <div class="container">
      <h1>Gi·ªè H√†ng C·ªßa B·∫°n</h1>
      
      <div class="cart-content">
        <div class="cart-items-section">
          <div id="cart-items" class="cart-list">
            <!-- Items rendered here -->
          </div>
        </div>

        <div class="cart-summary">
          <div class="summary-box">
            <h3>T·ªïng C·ªông</h3>
            <div class="summary-row">
              <span>Subtotal:</span>
              <span id="cart-total">0ƒë</span>
            </div>
            <div class="summary-row">
              <span>Shipping:</span>
              <span>Mi·ªÖn ph√≠</span>
            </div>
            <div class="summary-row total-row">
              <span>Total:</span>
              <span id="cart-grand-total">0ƒë</span>
            </div>
            <button id="checkout-btn" class="btn-checkout">Thanh to√°n</button>
            <a href="khuyen_mai.html" class="btn-continue">‚Üê Ti·∫øp t·ª•c mua s·∫Øm</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 Fashion Store. All rights reserved.</p>
    </div>
  </footer>

  <script src="cart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // sync grand total
      const updateGrandTotal = ()=>{
        const total = cart.total();
        const gt = document.getElementById('cart-grand-total');
        if(gt) gt.textContent = formatVnd(total);
      };
      
      function formatVnd(num){ 
        const n = parseInt(num||0,10); 
        if(isNaN(n)) return num; 
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + 'ƒë'; 
      }

      // render cart and sync totals
      cart.renderCart();
      updateGrandTotal();

      // re-render when items change (intercept renderCart)
      const origRender = cart.renderCart;
      cart.renderCart = function(){
        origRender();
        updateGrandTotal();
      };

      // checkout handler
      const checkoutBtn = document.getElementById('checkout-btn');
      if(checkoutBtn){
        checkoutBtn.addEventListener('click', ()=>{
          const total = cart.total();
          if(total <= 0){
            alert('Gi·ªè h√†ng tr·ªëng. Vui l√≤ng th√™m s·∫£n ph·∫©m.');
            return;
          }
          if(confirm(`X√°c nh·∫≠n thanh to√°n ${formatVnd(total)}?`)){
            alert('C·∫£m ∆°n b·∫°n! ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ti·∫øp nh·∫≠n. M√£ ƒë∆°n h√†ng: #' + Math.floor(Math.random()*100000));
            cart.clear();
            window.location.href = 'index.html';
          }
        });
      }
    });
  </script>
</body>
</html>
